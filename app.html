<!DOCTYPE html>


<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Application</title>

<!-- Josh local test calls for local editing, do not remove unless you are Joshua --
        <link rel="stylesheet" type="text/css" href="/bootstrap-3.3.4-dist/css/bootstrap.min.css">
        <script type="text/javascript" src="D3/d3.js"></script>
        <script type="text/javascript" src="jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="leaflet.css" />
        <script type="text/javascript" src="leaflet.js"></script>

<!-- End Josh local test section. -->


		<!-- Core bootstrap CSS -->
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

        <!-- d3 library -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script> 

        <!-- Ajax -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

        <!-- leaflet -->
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>

        <!-- line chart source -->
        <script src="data.js"></script>
        <script src="lineChart.js"></script>

        <!--Bar chart Source-->
        <script src="barChart.js"></script>


        <!-- jQuery -->
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

        <!-- Leaflet playback -->
        <script src="LeafletPlayback.js"></script>

       <!--//script
            //$(function() {
            //    $( "#datepicker" ).datepicker();
        //    });
        //script>
        -->
		<!-- Custom styles for this template -->
		<link href="styles.css" rel="stylesheet">
        
	</head>
	
	<body>

    <!--global vars-->
<!--    <script>
        var wind_min = null;
        var wind_max = null;
        var press_min = null;
        var press_max = null;
    </script>
    -->
	        <!-- This section begins the bootstrap button headers -->
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">Project 2</a>

                </div>
                <div id="navbar" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="app.html">Application</a></li>
                        <li><a href="facts.html">Facts</a></li>
                        <li><a href="setup.html">Setup</a></li>
                        <li><a href="data.html">Data</a></li>
                        <li><a href="work.html">Work</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="pageContent">
            <!-- PUT ALL PAGE CODE EITHER IN OR BELOW THIS DIV! OTHERWISE IT WILL FALL BELOW THE NAV BAR! -->

            <!-- Options -->
            <div class="inline" style="width:12vw;">
                <fieldset>
                    <legend>Options</legend>
                    <div id="optionmenu"></div>                <br />
                    <div id="ordermenu"></div>                <br />
                    Date: <input type="text" id="datepicker"> <br />
                    Show Heatmap: <input type="checkbox" id="heat" /> <br />
                    <!-- This is a temporary placement for a button, just for testing the play functionality -->
                    <button id="play" value="paused" onclick="playHit()">Play/Pause</button> <br />

                    
                    <br />
                    <br />
                </fieldset>
                <br />

                <!--<div>-->
                <fieldset>
                    <legend>Filters</legend>
                    <input value="0" type="number" id="min_speed" style="width:50px" />< Wind Speed < <input value="9999" type="number" id="max_speed" style="width:50px" /> <br />
                    <input value="0" type="number" id="min_pressure" style="width:50px" /> < Pressure < <input value="9999" type="number" id="max_pressure" style="width:50px" /> <br />
                    Made Land: <input type="checkbox" id="land" /> <br />
                    <button onclick="change()">Apply Filters</button>

                </fieldset>

            </div>

            <!-- atlantic list -->
            <div class="inline" style="height:80vh;width:8vw;">
                <fieldset style="width:100%;height:100%;overflow:auto;">
                    <legend style="font-size:15px; overflow:auto">Pacific Hurricanes</legend>
                    <div id="hurricanelist2" style="width:100%;height:100%; overflow:auto;"></div>
                </fieldset>
            </div>

            <!--maps-->
            <div class="inline" id = top style = "width: 40vw; height: 80vh;" >
                <div  id="map"  style="height: 100%; width:100%" class="inline"></div>                
                <!--<div id = "map" style = "height: 50%;"></div>-->
                <div id = "legend" style = "height: 50% ; "></div>

            </div>

            <!-- atlantic list -->
            <div class="inline" style="height:80vh;width:8vw;">
                <fieldset style="width:100%;height:100%;overflow:auto;">
                    <legend style="font-size:15px; overflow:auto">Atlantic Hurricanes</legend>
                    <div id="hurricanelist" style="width:100%;height:100%; overflow:auto;"></div>
                </fieldset>
            </div>          

            <!-- chart container-->
            <div id="chartContainer" class="inline" style="width:15vw">
                <div id="chart"></div>
                <div id="chart1"></div>
                <div id="graph1"> </div>
            </div>

            <div id="chartContainer2" class="inline" style="width:15vw">
                <div id="chart2"></div>
                <div id="chart3"></div>
                <div id="graph2"> </div>
            </div>

            <script type="text/javascript">
                var select;
                var order;
                var orderHurr = 0; // can be 0,1,2 depending on user selection.
                var index;
                var num = 0;
                var topNum =0;
                var mydate;
                var Color;
                var num_hurricanes = [[], [], [], [], [], [], [], [], [], []];
                 
                var polyline = {};
                var dateLine = {};
                
                var mydateline = [];
                var dateNames = [];
                var uniqueDateNames = [];
                var dateCounter=0;
                var numHurrDate=0;
                
                var day_lat = {};
                var day_lag = {};
                var day_wind = {};
                var day_name = {};
                
                
                var Namedict = [];
                var Timedict = [];
                var Speeddict = [];

                var hurriSelection = [];
                var hurricanesByID = [];
                var hurricanesByName = [];
                var timersArray = [];
                var unprintedVals = [];
                var circles = [];

                var mytop5 = [];
                var mytop10 = [];

                var latitute = [[], [], [], [], [], [], [], [], [], []];
                var langitute = [[], [], [], [], [], [], [], [], [], []];
                var wind = [[], [], [], [], [], [], [], [], [], []];
                var names = [[], [], [], [], [], [], [], [], [], []];

                var latitute_id = new Array();
                var langitute_id = new Array();
                var wind_id = new Array();
                var year_id = new Array();
                var name_id = new Array();
                var MinPress_id = new Array();
          
                var map = L.map('map').setView([41.83, -100], 3);

                // creating a map

                L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                    attribution: 'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://mapbox.com">Mapbox</a>',
                    maxZoom: 18,
                    noWrap: true,
                    id: 'ygordon22.cifd9ql4c53tbsmlx7cegx4iy',
                    accessToken: 'pk.eyJ1IjoieWdvcmRvbjIyIiwiYSI6ImNpZmQ5cW1idzUzeWFzNG03bjVqc3czZWEifQ.dpecRLb3F4lRAOvIVd5KpQ'
                }).addTo(map);


                var playbackOptions = {
                    playControl: true,
                    dateControl: true,
                    sliderControl: true,
                    tickLen: 60*60*1000
                };
                //var playback = new L.Playback(map, null, null, playbackOptions);

                function change() {
                    
                    if (num != 0) {
                d3.select(".map").remove();   
                d3.select("#hurricanelist").selectAll("input").remove();
                d3.select("#hurricanelist").selectAll('label').remove();
                d3.select("#hurricanelist2").selectAll("input").remove();
                d3.select("#hurricanelist2").selectAll('label').remove();
                    }

                    
                    var selectedIndex = select.property('selectedIndex'),
                    input = options[0][selectedIndex].__data__;
                    var chosenYear = parseInt(input.Hurricane);
                    index = selectedIndex -1;
                   
                    

                    //method to create linechart
                    if(index < 10)
                    {
                        updateline1(HurrData1[index],graphs[0]);
                        updateline1(HurrData2[index],graphs[1]);

                    }

                    var color;

                    if (input.Hurricane == 'All') {
                        var myline = new Array();
                        var polyline_options;
                        for (var k = 0; k < wind_id.length; k++) {
                            myline[k] = new Array();
                            var Average = averageWindSpped(wind_id[k])
                            for(var j=0;j<wind_id[k].length;j++){
                            myline[k][j] = new Array(2);
                            myline[k][j][0] = parseFloat(latitute_id[k][j]);
                            myline[k][j][1] = parseFloat(langitute_id[k][j]);
                         }                        
                        determineColor(Average);  
                            
                        polyline_options = {
                            color: Color
                         };    
                             polyline["ALL"+topNum.toString()]=L.polyline(myline[k],polyline_options).addTo(map);
                             topNum++;
                        } 
                              
                        
                    var ALLbox =[]
                    ALLbox.push("ALL");
                    
                    d3.select("#hurricanelist").selectAll("input")
                          .data(ALLbox)
                          .enter()
                          .append('label')
                          .style("font-size", "12px")
                              .text("Remove ALL")
                              .append("input")
                              .attr("val", false)
                              .attr("type", "checkbox")
                              .attr("id", function (d, i) { return ALLbox[i]; })
                              .attr("onClick", "modify(this)")
                              .attr("onClick", "drawPath(this)");
                               num++;
                        }
                    
                    else if (input.Hurricane == 'TOP5') {
                        top5();
                        var myline = [[], [], [], [], []];
                        var polyline_options; 
                        top10();
                        for (var k = 0; k < 5; k++) {
                            var Average = averageWindSpped(wind_id[mytop5[k]]);
                             alert(wind_id[mytop5[k]]);
                            
                             myline[k] = new Array();
                             for (var j = 0; j < wind_id[mytop5[k]].length; j++) {
                             myline[k][j] = new Array(2);
                             myline[k][j][0] = parseFloat(latitute_id[mytop5[k]][j]);
                             myline[k][j][1] = parseFloat(langitute_id[mytop5[k]][j]);
                              }  
                            
                             determineColor(Average);
                             alert(Color);
                        polyline_options = {
                            color: Color
                         };    
                            
                             polyline["TOP5"+topNum.toString()]=L.polyline(myline[k],polyline_options).addTo(map);
                            
                             topNum++;     
                        }
                        
                    var Top5box =[]
                    Top5box.push("TOP5");
                    
                    d3.select("#hurricanelist").selectAll("input")
                          .data(Top5box)
                          .enter()
                          .append('label')
                          .style("font-size", "12px")
                              .text("Remove TOP5")
                              .append("input")
                              .attr("val", false)
                              .attr("type", "checkbox")
                              .attr("id", function (d, i) { return Top5box[i]; })
                              .attr("onClick", "modify(this)")
                              .attr("onClick", "drawPath(this)");
                               num++;
                    }
                    
                    else if (input.Hurricane == 'TOP10') {

                        var myline = [[], [], [], [], [], [], [], [], [], []];
                        var polyline_options; 
                        top10();
                        
                        for (var k = 0; k < 10; k++) {
                             myline[k] = new Array();
                            var Average = averageWindSpped(wind_id[mytop10[k]]);
                             myline[k] = new Array();
                            
                             for (var j = 0; j < wind_id[mytop10[k]].length; j++) {
                             myline[k][j] = new Array(2);
                             myline[k][j][0] = parseFloat(latitute_id[mytop10[k]][j]);
                             myline[k][j][1] = parseFloat(langitute_id[mytop10[k]][j]);
                             }
                            
                             determineColor(Average);
                             alert(Color);                 
                        polyline_options = {
                            color: Color
                         };    
                            
                             polyline["TOP10"+topNum.toString()]=L.polyline(myline[k],polyline_options).addTo(map);
                            
                             topNum++;     
                            }
                        
                        
                    var Top10box =[]
                    Top10box.push("TOP10");
                    
                    d3.select("#hurricanelist").selectAll("input")
                          .data(Top10box)
                          .enter()
                          .append('label')
                          .style("font-size", "12px")
                              .text("Remove TOP10")
                              .append("input")
                              .attr("val", false)
                              .attr("type", "checkbox")
                              .attr("id", function (d, i) { return Top10box[i]; })
                              .attr("onClick", "modify(this)")
                              .attr("onClick", "drawPath(this)");
                               num++;
                        }

                    else {

                        var uniqueNames = [];
                        var mynames = [];
                        var starting_position =0;
                        var ending_position =0;
              
                        
                        for(var j=0; j<(index+1);j++){
                            starting_position += num_hurricanes[j].length;
                        }
                        ending_position = starting_position + num_hurricanes[index].length;
                        
                    
                        
                        if (orderHurr == 0) {
                               for(var k =0; k<num_hurricanes[index].length;k++){
                                   mynames.push(num_hurricanes[index][k]);
                               }
                            console.log(mynames.toString());
                            
                        }
                        else if (orderHurr == 1) {
                              console.log(Timedict.length)
                              for(var k=0;k<Timedict.length;k++){
                                  console.log(Timedict[k].key);
                                  if (Timedict[k].key > starting_position && Timedict[k].key < ending_position){
                                      console.log('pushed this');
                                      console.log(num_hurricanes[index][Timedict[k].key-starting_position]);
                                      mynames.push(num_hurricanes[index][Timedict[k].key-starting_position]);
                                  }
                          }
                            console.log(mynames.toString());
                        }
                        
                        else if (orderHurr == 2) {
                               console.log(Speeddict);
                                         for(var k=0;k<Speeddict.length;k++){
                                  console.log(Speeddict[k].key);
                                  if (Speeddict[k].key > starting_position && Speeddict[k].key < ending_position){
                                      console.log('pushed this');
                                      console.log(num_hurricanes[index][Speeddict[k].key-starting_position]);
                                      mynames.push(num_hurricanes[index][Speeddict[k].key-starting_position]);
                                  }
                          }
                            
                            console.log(mynames.toString());
                            
                        }

                        $.each(mynames, function (i, el) {
                            if ($.inArray(el, uniqueNames) === -1) uniqueNames.push(el);
                        });
                        uniqueNames.push("all");


                    // Creating a legend with all hurricane name
         
                      svg = d3.select("#hurricanelist").selectAll("input")
                          .data(uniqueNames)
                          .enter()
                          .append('label')
                          .style("font-size", "50%")
                              .attr('for', function (d, i) { return 'a' + i; })
                              .text(function (d)
                              {
                                  var wind;
                                  var pressure;
                                  if (d == "all")
                                      return d;
                                  /*Get max wind speed for hurricane*/
                                  for ( var key in Namedict )
                                  {
                                      var mykey = Namedict[key].key;
                                      if ( Namedict[key].value == d)
                                      {
                                          wind = Math.max.apply(null, wind_id[mykey]);
                                          pressure = Math.max.apply(null, MinPress_id[mykey]);
                                      }
                                  }
                                  if (wind >= document.getElementById("min_speed").value && wind <= document.getElementById("max_speed").value
                                      && pressure >= document.getElementById("min_pressure").value && pressure <= document.getElementById("max_pressure").value)
                                      return d;
                              })
                              .append("input")
                              .style("display", function(d){
                                  var wind;
                                  var pressure;
                                  if (d == "all")
                                      return d;
                                  /*Get max wind speed for hurricane*/
                                  for ( var key in Namedict )
                                  {
                                      var mykey = Namedict[key].key;
                                      if ( Namedict[key].value == d)
                                      {
                                          wind = Math.max.apply(null, wind_id[mykey]);
                                          pressure = Math.max.apply(null, MinPress_id[mykey]);
                                      }
                                  }
                                  if (wind >= document.getElementById("min_speed").value && wind <= document.getElementById("max_speed").value
                                      && pressure >= document.getElementById("min_pressure").value && pressure <= document.getElementById("max_pressure").value)
                                      return null;
                                  else
                                      return "none";
                              })
                              .attr("val", false)
                              .attr("type", "checkbox")
                              .attr("id", function (d, i) { return uniqueNames[i]; })
                              .attr("onClick", "modify(this)")
                              .attr("onClick", "drawPath(this)");

                      //legend = svg.append("g")
                      //      .attr("class", "legend")
                      //      .attr("transform", "translate(50,30)")
                      //      .style("font-size", "12px")
                      //      .call(d3.legend);

                      svg = d3.select("#hurricanelist2").selectAll("input")
                           .data(uniqueNames)
                           .enter()
                           .append('label')
                           .style("font-size", "12px")
                               .attr('for', function (d, i) { return 'a' + i; })
                               .text(function (d) { return d; })
                               .append("input")
                               .attr("val", false)
                               .attr("type", "checkbox")
                               .attr("id", function (d, i) { return uniqueNames[i]; })
                               .attr("onClick", "modify(this)")
                               .attr("onClick", "drawPath(this)");
                    num++;

                }
                }

                function changeOrder() {
                    var selectedIndex = order.property('selectedIndex'),
                    input = options2[0][selectedIndex].__data__;
                    var myorder = input.order;

                    if (myorder == 'chronologically') {
                        orderHurr = 1;
                    }

                    else if (myorder == 'MaxWindSpeed') {
                        console.log(JSON.stringify(Speeddict));
                        orderHurr = 2;
                    }
                    else if (myorder == 'alphabetically'){
                        orderHurr = 0;
                    }
                };
                
                  function drawPath(that){
                      
                  var check = $(that).attr("val");      
                  var polyline_options; 
                  var myline;
                  
                  if (check == 'false'){
                   myline = new Array();
                  var dot = [];
                  var val = $(that).attr("id");
                      
                     if(val == "TOP10"){
                     for(var key in polyline) {
                           if(key.indexOf(val) != -1){
                              map.removeLayer(polyline[key]);
                            }  
                          }
                     }
                          else if(val == "TOP5"){
                              for(var key in polyline) {
                           if(key.indexOf(val) != -1){
                              map.removeLayer(polyline[key]);
                            }  
                            }
                          }
                      
                          else if(val == "ALL"){
                              for(var key in polyline) {
                           if(key.indexOf(val) != -1){
                              map.removeLayer(polyline[key]);
                            }  
                          }
                          }
                            else if(val == "All"){
                          alert(index);
                            var numHurr=0;
                              for(var i=0;i<names[index].length;i++){
                                 for (var j=0;j<name_id.length;j++){      
                                    if(names[index][i] == name_id[j][0]){
                                        alert(names[index][i]);
                                        alert(name_id[j][0]);
                                    var Average = averageWindSpped(wind_id[j]);
                                        alert(Average);
                                    for( var i =0; i<wind_id[j].length;i++){
                                    myline[i] = new Array(2);
                                    myline[i][0] = parseFloat(latitute_id[j][i]);
                                    myline[i][1] = parseFloat(langitute_id[j][i]);
                                     }                
                         determineColor(Average);
                        polyline_options = {
                            color: Color
                         };
                         
     polyline["All"+numHurr.toString()] = L.polyline(myline,polyline_options).addTo(map);
                                 numHurr++;
                                    }
                              }
                          }
                      }
                          
                          else{
                    for ( var key in Namedict ) {
                      var mykey = Namedict[key].key;
                     if ( Namedict[key].value == val){
                         console.log(wind_id[mykey].length);
                         var Average = averageWindSpped(wind_id[Namedict[key].key]);
                         for( var i =0; i<wind_id[mykey].length;i++){
                             myline[i] = new Array(2);
                             myline[i][0] = parseFloat(latitute_id[mykey][i]);
                             myline[i][1] = parseFloat(langitute_id[mykey][i]);
               }                
                         determineColor(Average);
                        polyline_options = {
                            color: Color
                         };
                         
                        polyline[val] = L.polyline(myline,polyline_options).addTo(map);
                         
                         break;
                     }
                     }
                     }
                  }
                  else if (check == 'true') {

                      //Clear out all the circles:
                      for (var i = 0; i < circles.length; i++) {
                          map.removeLayer(circles[i]);
                      }
                      timersArray.splice(0, timersArray.length);
                      circles.splice(0, circles.length);
                      unprintedVals.splice(0, unprintedVals.length);

                      //Finish clearing circles and other arrays.

                          if(val == "All"){
                          alert(index);
                              for(var key in polyline){
                                 if(key.indexOf(All) != -1){
                                  map.removeLayer(polyline[key]);
                                 }
                              }
                           }
                          
                          else{
                          var val = $(that).attr("id");
                         map.removeLayer(polyline[val]);
                          if (dateLine[val]){
                         map.removeLayer(dateLine[val]);
                             }
                          }
                      }
                     modify(that);
                  }
                
                function modify(that) {
                    
                    var val = $(that);//.attr("id");
                    var selName = val.attr("id");
                    if (val.context.attributes.val.value == "true") {
                        val.context.attributes.val.value = "false";
                        for (var i = 0; i < hurriSelection.length; i++) {
                            if (selName == hurriSelection[i].values[0].NAME) {
                                hurriSelection.splice(i, 1);
                                console.log(hurriSelection);
                                break;
                            }
                        }
                        
                        //This is where we will need to run the remove code for a single hurricane.


                    } else {
                        val.context.attributes.val.value = "true"
                        
                        for (var i = 0; i < hurricanesByID.length; i++) {
                            if (selName == hurricanesByID[i].values[0].NAME) {
                                hurriSelection.push(hurricanesByID[i]);
                                break;
                            }
                        }
                        console.log(hurriSelection);

                        var geoJsonObjects = [];

                        for (var hurricane in hurriSelection) {
                            var lnglat = [];
                            var time = [];
                            console.log(hurricane);
                            for (var hurr in hurriSelection[hurricane].values) {

                                var strDate;
                                lnglat.push([hurriSelection[hurricane].values[hurr].LOG, hurriSelection[hurricane].values[hurr].LAT]);
                                var hour = hurriSelection[hurricane].values[hurr].HOURS[0] + "" + hurriSelection[hurricane].values[hurr].HOURS[1];

                                var tempDate = Date.UTC(hurriSelection[hurricane].values[hurr].YEAR, hurriSelection[hurricane].values[hurr].MONTH, hurriSelection[hurricane].values[hurr].DAY, hour);
                                time.push(tempDate);
                            } // End of the for function.

                            var geoJson = {
                                "type": "Feature",
                                "geometry": {
                                    "type": "MultiPoint",
                                    "coordinates": lnglat
                                },
                                "properties": {
                                    "time": time
                                }
                            };

                            geoJsonObjects.push(geoJson);

                        }

                        for (var key in Namedict) {

                      var mykey = Namedict[key].key;

                     if ( Namedict[key].value == val){
                         console.log(wind_id[Namedict[key].key].length);
                         for( var i =0; i<wind_id[Namedict[key].key].length;i++){
                             
                       if (wind_id[Namedict[key].key][i] > 40){  // coloring scheme
                        color ='red'
                    }
                        else{
                            color = 'green'
                        }

                // adding a circle for every hurricane generated by user specification.               
 /*                  var circle = L.circle([latitute_id[mykey][i],langitute_id[mykey][i]], 500, {
            color: color,
            fillColor: '#f03',
            fillOpacity: 0.5
        }).addTo(map)
*/

               }
                         break;
                     }
                     }
                }
                }


                function top5() {
                    var maxspeed = [];
                    var shift=0;
                    Array.max = function (array) {
                        return Math.max.apply(Math, array);
                    };
                    
                    // finding max speed for each hurricane 
                    for (var i = 0; i < wind_id.length; i++) {
                        maxspeed.push(Array.max(wind_id[i]));
                    }
                    alert(JSON.stringify(maxspeed));

                    // finding the strongest 5 hurricanes 

                    for (var k = 0; k < 5; k++) {
                        shift=0;
                        var i = maxspeed.indexOf(Math.max.apply(Math, maxspeed));
                        for(var j =0;j<mytop5.length;j++){
                            if(i+k > mytop5[j]){
                                shift++;
                            }
                        }
                        mytop5.push(i+shift);
                        maxspeed.splice(i, 1);
                    }
                    alert(mytop5);
                    for (var k = 0; k < 5; k++) {
                        alert(maxspeed[mytop5[k]]);
                    }
                }; //End of the top 5 function.

                function top10() {
                    var maxspeed = [];
                    var shift=0;
                    Array.max = function (array) {
                        return Math.max.apply(Math, array);
                    };
                    
                    // finding max speed for each hurricane 
                    for (var i = 0; i < wind_id.length; i++) {
                        maxspeed.push(Array.max(wind_id[i]));
                    }
                    alert(JSON.stringify(maxspeed));

                    // finding the strongest 5 hurricanes 

                    for (var k = 0; k < 10; k++) {
                        shift=0;
                        var i = maxspeed.indexOf(Math.max.apply(Math, maxspeed));
                        for(var j =0;j<mytop10.length;j++){
                            if(i+k > mytop10[j]){
                                shift++;
                            }
                        }
                        mytop10.push(i+shift);
                        maxspeed.splice(i, 1);
                    }
                    alert(mytop5);
                    for (var k = 0; k < 10; k++) {
                        alert(maxspeed[mytop10[k]]);
                    }
                }; //End of the top 10 function.
                
                function averageWindSpped(WindSpeed){
                    var sum=0;
                    for (var j = 0; j < WindSpeed.length; j++) {
                        sum = sum + parseInt(WindSpeed[j]);
                    }
                    return sum/(WindSpeed.length);
                }
                       
                function determineColor(Average){
                
                    if(Average < 20){
                        Color = 'blue'
                    }
                    else if(Average>20 && Average<30){
                        Color = 'green'
                    }
                    else if(Average>30 && Average<40){
                        Color = 'yellow'
                    }
                    else if(Average>40 && Average<50){
                        Color = 'orange'
                    }
                    else if(Average>50 && Average<60){
                        Color = 'red'
                    }
                    else if(Average>60 && Average<70){
                        Color = 'pink'
                    }
                    else if(Average >70 ){
                        Color = 'purple'
                            }
                }
          
        $(function() {
                $('#datepicker').datepicker();
                 $('#datepicker').datepicker('option', 'onSelect', function(dateText,inst) {      
                     var i =0;
                     for(var key in day_lat) {
                        if(day_lat.hasOwnProperty(key)) {
                           if(key.indexOf(dateText) != -1){
                               mydateline[i] = new Array(2);
                               mydateline[i][0] = parseFloat(day_lat[key]);
                               mydateline[i][1] = parseFloat(day_lag[key]);
                               dateNames[numHurrDate] = day_name[key];
                               i++;
                               numHurrDate++;
               }                         
                       var line_options = {
                            color: 'red'
                         };
                        }
                     }
                     
                         $.each(dateNames, function (i, el) {
                            if ($.inArray(el, uniqueDateNames) === -1) uniqueDateNames.push(el);
                        });
                     
                     dateLine[uniqueDateNames[dateCounter]] = L.polyline(mydateline,line_options).addTo(map);
                        
                     if(dateCounter >0 || num >0){
                d3.select("#hurricanelist").selectAll("input").remove();
                d3.select("#hurricanelist").selectAll('label').remove();
                     }
                    d3.select("#hurricanelist").selectAll("input")
                          .data(uniqueDateNames)
                          .enter()
                          .append('label')
                          .style("font-size", "12px")
                              .attr('for', function (d, i) { return 'a' + i; })
                              .text(function (d) { return d; })
                              .append("input")
                              .attr("val", false)
                              .attr("type", "checkbox")
                              .attr("id", function (d, i) { return uniqueDateNames[i]; })
                              .attr("onClick", "modify(this)")
                              .attr("onClick", "drawPath(this)");
                     
                           dateCounter++; 
                        });
                   });
                
                
                d3.csv("data/Hurricanes.csv", function (error, text) {
                    console.log(text);
                    select = d3.select("#optionmenu").append("select").on("change", change);
                    options = select.selectAll('option').data(text);
                    var selection = options.enter().append("option").text(function (d) { return d.Hurricane; });
                });

                d3.csv("data/order.csv", function (error, text) {
                    order = d3.select("#ordermenu").append("select").on("change", changeOrder);
                    options2 = order.selectAll('option').data(text);
                    var selection2 = options2.enter().append("option").text(function (d) { return d.order; });

                });

                //The section below grabs the hurricanes from 2005-2014 and groups them by hurricane YEAR. Thus breaking the file into 10 objects instead of 5000 entries.
                d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                    var i = 0;
                    var data = d3.nest()
                        .key(function (d) {
                            return d.YEAR;
                        })
                    .rollup(function (leaves) {
                        for (var j = 0 ; j < leaves.length; j++) {
                            langitute[i][j] = (leaves[j].LOG);
                            latitute[i][j] = (leaves[j].LAT);
                            wind[i][j] = (leaves[j].MaxWind);
                            names[i][j] = (leaves[j].NAME);
                        }
                        i++;
                        return leaves.length;
                    })
                    .entries(text);
                });

                //The section below grabs the hurricanes from 2005-2014 and groups them by hurricane YEAR. Thus breaking the file into 10 objects instead of 5000 entries.
                d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                    var i = 0;
                    var data = d3.nest()
                        .key(function (d) {
                            return d.NAME;
                        }).entries(text);

                    for (var i = 0; i < data.length; i++) {
                        hurricanesByID.push(data[i]);
                    }
                    console.log("hurricane obj by id");
                    console.log(data);
                });
            
                // This function gets clusters by year, month, day
                
                           d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                    var i = 0;
                    var data = d3.nest()
                        .key(function (d) {
                            return d.YEAR;
                        })
                        .key(function (d) {
                            return d.MONTH;
                        })
                    .key(function (d) {
                            return d.DAY;
                        })
                    .rollup(function (leaves) {
                        //alert(JSON.stringify(leaves[0]));
                        var mykey = leaves[0].MONTH + "/" + leaves[0].DAY + "/" +leaves[0].YEAR;
                        console.log(mykey);
                        for (var j = 0 ; j < leaves.length; j++) {
                            mykey += "|" + j.toString();
                            
                            day_lat[mykey] =  leaves[j].LAT;
                            day_lag[mykey] =  leaves[j].LOG;
                            day_wind[mykey] = leaves[j].MaxWind;
                            day_name[mykey] = leaves[j].NAME;
                        }
                        i++;
                        return leaves.length;
                    })
                    .entries(text);
                               
                });
                
                //The function below grabs the hurricane data and breaks it up into HURID.
                
                d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                    var i = 0;
                    var data = d3.nest()
                        .key(function (d) {
                            return d.HURID;
                        })
                    .rollup(function (leaves) {
                        //alert(JSON.stringify(leaves[0]));
                        langitute_id[i] = new Array();
                        latitute_id[i] = new Array();
                        wind_id[i] = new Array();
                        year_id[i] = new Array();
                        name_id[i] = new Array();
                        MinPress_id[i] = new Array();
                        for (var j = 0 ; j < leaves.length; j++) {
                            // creating arrays for all the hurricane

                            langitute_id[i][j] = (leaves[j].LOG);
                            latitute_id[i][j] = (leaves[j].LAT);
                            wind_id[i][j] = (leaves[j].MaxWind);
                            year_id[i][j] = (leaves[j].YEAR);
                            name_id[i][j] = leaves[j].NAME;
                            MinPress_id[i][j] = leaves[j].MinPress;
                        }


                        Namedict.push({
                            key: i.toString(),
                            value: leaves[0].NAME
                        });

                        Timedict.push({
                            key: i.toString(),
                            value: leaves[0].MONTH
                        });

                        Speeddict.push({
                            key: i.toString(),
                            value: leaves[0].MaxWind
                        });


                        i++;
                        return leaves.length;
                    })
                        .entries(text);


                    Timedict = sortOnValue(Timedict);
                    Speeddict = sortOnValue(Speeddict);
                    
                
                    console.log(num_hurricanes.length);
                    
                    for(var i=0;i<num_hurricanes.length;i++){
                    $.each(names[i], function (k, el) {
                            if ($.inArray(el, num_hurricanes[i]) === -1) num_hurricanes[i].push(el);
                        });
                        console.log('get here');
                        console.log(num_hurricanes[i].toString());
                        console.log(num_hurricanes[i].length);
                        
                    }
                });

                function sortOnValue(dict) {
                    var sortable = [];
                    var temp = []
                    for (var key in dict) {
                        sortable.push([key, dict[key].value])
                    }
                    sortable.sort(function (a, b) { return a[1] - b[1] })
                    // console.log(JSON.stringify(sortable));

                    for (var key in sortable) {
                        temp.push({
                            key: sortable[key][0],
                            value: sortable[key][1]
                        });
                    }

                    return temp;
                }; //End of the sortOnValue function.


                function playHit() {
                    var button = document.getElementById("play");
                    var loopFlag = 0;
                    //The function below sorts the selected hurricane list based on the start date of each hurricane.
                    hurriSelection.sort(function (A, B) {
                        var hourA = A.values[0].HOURS[0] + "" + A.values[0].HOURS[1];
                        var hourB = B.values[0].HOURS[0] + "" + B.values[0].HOURS[1];
                        var tempDateA = Date.UTC(A.values[0].YEAR, A.values[0].MONTH, A.values[0].DAY, hourA);
                        var tempDateB = Date.UTC(B.values[0].YEAR, B.values[0].MONTH, B.values[0].DAY, hourB);
                        return tempDateA - tempDateB;
                    });



                    if(button.value == "paused") {
                        console.log ("play");
                        button.value = "play";
                        button.textContent = "Pause";
                        var month, day, hour;
                        month = hurriSelection[0].values[0].MONTH;
                        day = hurriSelection[0].values[0].DAY;
                        hour = hurriSelection[0].HOURS;

                        var points = [];
                        var totalLength = 0;

                        for (var i = 0; i < hurriSelection.length; i++) {
                            for (var j = 0; j < hurriSelection[i].values.length; j++) {
                            
                                points.push(hurriSelection[i].values[j]);

                                //return tempDateA - tempDateB;
                                //var lat = hurriSelection[i].values[j].LAT;
                                //var long = hurriSelection[i].values[j].LOG
                                //setTimer(j, lat, long);
                            }
                        }

                        var circle;

                        if (timersArray.length > 0) {
                            console.log(timersArray);
                            //setTimeout(timersArray[timersArray.length - 1]);
                            var tempScale = (unprintedVals.length - 1);
                            for (var i = unprintedVals[tempScale] + 1; i < points.length; i++) {
                                var lat = points[i].LAT;
                                var long = points[i].LOG;

                                setTimer(circles, i - tempScale, lat, long);
                            }

                            var finalTimer = setTimeout(function () {
                                //clearTimeout(timer);
                                //map.removeLayer(circle);
                                console.log(circles);
                                for (var i = 0; i < circles.length; i++) {
                                    map.removeLayer(circles[i]);
                                }
                                timersArray.splice(0, timersArray.length);
                                circles.splice(0, circles.length);
                                unprintedVals.splice(0, unprintedVals.length);

                            }, 1001 * points.length);

                            timersArray.push(finalTimer);

                        } else {


                            for (var i = 0; i < points.length; i++) {
                                var lat = points[i].LAT;
                                var long = points[i].LOG;

                                setTimer(circles, i, lat, long);
                            }

                            var finalTimer = setTimeout(function () {
                                //clearTimeout(timer);
                                //map.removeLayer(circle);
                                console.log(circles);
                                for (var i = 0; i < circles.length; i++) {
                                    map.removeLayer(circles[i]);
                                }
                                timersArray.splice(0, timersArray.length);
                                button.value = "paused";
                                button.textContent = "Play";

                            }, 1001 * points.length);

                            timersArray.push(finalTimer);
                        }
                        //button.value = "paused";
                        //button.textContent = "Play";


                    } else {
                        //clearInterval(timer);
                        clearTimeout(timersArray[timersArray.length - 1]);
                        timersArray.pop();

                        for (var i = 0; i < timersArray.length; i++) {
                            clearTimeout(timersArray[i]);
                        }

                        console.log("paused");
                        button.value = "paused"
                        button.textContent = "Play";
                    }


                    console.log(hurriSelection[0].values[0].HOURS);
                }; //End of the Play function.

                function setTimer(circles, i, lat, long) {
                    timer = setTimeout(function () {
                        //var circle = L.circle([hurriSelection[i].values[j].LAT, hurriSelection[i].values[j].LOG], 500, {
                        var circle = L.circle([lat, long], 500, {
                            color: 'black',
                            fillColor: '#f03',
                            fillOpacity: 0.5
                        }).addTo(map);
                        circles.push(circle);
                        unprintedVals.push(i);

                    }, i * 1000, lat, long);
                    timersArray.push(timer);
                }

                function sleep(milliseconds) {
                    var start = new Date().getTime();
                    for (var i = 0; i < 1e7; i++) {
                        if ((new Date().getTime() - start) > milliseconds) {
                            break;
                        }
                    }
                }; //End of the sleep function.

                function toTimestamp(strDate) {
                    var datum = Date.parse(strDate);
                    return datum/1000;
                }; //End of the toTimestamp function.
                    
            </script>

        </div>
        <script type=text/javascript>
            d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                //Create a year array to hold the count of hurricanes per year.
                var yearArray = [0,0,0,0,0,0,0,0,0,0];

                //Group the data by hurricane id
                var data = d3.nest()
                .key(function(d) {
                    return d.HURID;
                }).entries(text);

                //Loop through the data to get the count of hurricanes per year.
                for (var i = 0; i < data.length; i++) {
                    //The "-0" is to force the conversion from string to integer for use in the switch case.
                    switch(data[i].values[0].YEAR - 0) {
                        case 2005:
                            yearArray[0]++;
                            console.log("2005");
                            break;
                        case 2006:
                            yearArray[1]++;
                            break;
                        case 2007:
                            yearArray[2]++;
                            break;
                        case 2008:
                            yearArray[3]++;
                            break;
                        case 2009:
                            yearArray[4]++;
                            break;
                        case 2010:
                            yearArray[5]++;
                            break;
                        case 2011:
                            yearArray[6]++;
                            break;
                        case 2012:
                            yearArray[7]++;
                            break;
                        case 2013:
                            yearArray[8]++;
                            break;
                        case 2014:
                            yearArray[9]++;
                            break;
                    }
                
                } //Ends the for loop.
                //Print out the content of the yearArray to the console for checking.
                //console.log(yearArray);
            }); //End the d3.csv call.
        </script>
	</body>
</html>