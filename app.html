<!DOCTYPE html>


<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Application</title>

<!-- Josh local test calls for local editing, do not remove unless you are Joshua --
        <link rel="stylesheet" type="text/css" href="/bootstrap-3.3.4-dist/css/bootstrap.min.css">
        <script type="text/javascript" src="D3/d3.js"></script>
        <script type="text/javascript" src="jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="leaflet.css" />
        <script type="text/javascript" src="leaflet.js"></script>

<!-- End Josh local test section. -->


		<!-- Core bootstrap CSS -->
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

        <!-- d3 library -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script> 

        <!-- Ajax -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

        <!-- leaflet -->
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>

        <!-- line chart source -->
        <script src="data.js"></script>
        <script src="lineChart.js"></script>

        <!--Bar chart Source-->
        <script src="barChart.js"></script>


        <!-- jQuery -->
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

        <!-- Leaflet playback -->
        <script src="LeafletPlayback.js"></script>

       <!--//script
            //$(function() {
            //    $( "#datepicker" ).datepicker();
        //    });
        //script>
        -->
		<!-- Custom styles for this template -->
		<link href="styles.css" rel="stylesheet">
        
	</head>
	
	<body>
	        <!-- This section begins the bootstrap button headers -->
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">Project 2</a>

                </div>
                <div id="navbar" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="app.html">Application</a></li>
                        <li><a href="facts.html">Facts</a></li>
                        <li><a href="setup.html">Setup</a></li>
                        <li><a href="data.html">Data</a></li>
                        <li><a href="work.html">Work</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="pageContent">
            <!-- PUT ALL PAGE CODE EITHER IN OR BELOW THIS DIV! OTHERWISE IT WILL FALL BELOW THE NAV BAR! -->

            <!-- Options -->
            <div class="inline" style="width:12vw;">
                <fieldset>
                    <legend>Options</legend>
                    <div id="optionmenu"></div>                <br />
                    <div id="ordermenu"></div>                <br />
                    Date: <input type="text" id="datepicker"> <br />
                    Show Heatmap: <input type="checkbox" id="heat" /> <br />
                    <!-- This is a temporary placement for a button, just for testing the play functionality -->
                    <!--<button id="play" value = "paused" onclick="playHit()">Play/Pause</button>-->
                    <br />
                    <br />
                </fieldset>
                <br />

                <!--<div>-->
                <fieldset>
                    <legend>Filters</legend>
                    <input type="number" id="min_speed" style="width:50px" /> < Wind Speed < <input type="number" id="max_speed" style="width:50px" /> <br />
                    <input type="number" id="min_pressure" style="width:50px" /> < Pressure < <input type="number" id="max_pressure" style="width:50px" /> <br />
                    Made Land: <input type="checkbox" id="land" /> <br />

                </fieldset>

            </div>

            <!-- atlantic list -->
            <div class="inline" style="height:80vh;width:8vw;">
                <fieldset style="width:100%;height:100%;overflow:auto;">
                    <legend style="font-size:15px; overflow:auto">Pacific Hurricanes</legend>
                    <div id="hurricanelist2" style="width:100%;height:100%; overflow:auto;"></div>
                </fieldset>
            </div>

            <!--maps-->
            <div class="inline" id = top style = "width: 50vw; height: 80vh;" >
                <div id="map2" style="height: 100%; width:50%" class="inline"></div>
                <div  id="map"  style="height: 100%; width:50%" class="inline"></div>                
                <!--<div id = "map" style = "height: 50%;"></div>-->
                <div id = "legend" style = "height: 50% ; "></div>

            </div>

            <!-- atlantic list -->
            <div class="inline" style="height:80vh;width:8vw;">
                <fieldset style="width:100%;height:100%;overflow:auto;">
                    <legend style="font-size:15px; overflow:auto">Atlantic Hurricanes</legend>
                    <div id="hurricanelist" style="width:100%;height:100%; overflow:auto;"></div>
                </fieldset>
            </div>          

            <!-- chart container-->
            <div id="chartContainer" class="inline" style="width:19vw">
                <div id="chart"></div>
                <div id="chart1"></div>
                <div id="graph1"> </div>
            </div>

            <div id="chartContainer2" class="inline" style="...">
                <div id="chart2"></div>
                <div id="chart3"></div>
                <div id="graph2"> </div>
            </div>

            <script type="text/javascript">
                var select;
                var order;
                var orderHurr = 0; // can be 0,1,2 depending on user selection.
                var index;
                var num = 0;
                var topNum =0;
                var mydate;
                
                var num_hurricanes = [[], [], [], [], [], [], [], [], [], []];
                 
                var polyline = {};
                var dateLine = {};
                
                var mydateline = [];
                var dateNames = [];
                var uniqueDateNames = [];
                var dateCounter=0;
                var numHurrDate=0;
                
                var day_lat = {};
                var day_lag = {};
                var day_wind = {};
                var day_name = {};
                
                
                var Namedict = [];
                var Timedict = [];
                var Speeddict = [];

                var hurriSelection = [];
                var hurricanesByID = [];
                var hurricanesByName = [];

                var mytop5 = [];
                var mytop10 = [];

                var latitute = [[], [], [], [], [], [], [], [], [], []];
                var langitute = [[], [], [], [], [], [], [], [], [], []];
                var wind = [[], [], [], [], [], [], [], [], [], []];
                var names = [[], [], [], [], [], [], [], [], [], []];

                //creating a 2d array with constant size of 170
                //since there are 170 distinct hurricane names
                // temporary solution !!!!.


                var latitute_id = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []];


                var langitute_id = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []];

                var wind_id = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []];

                var year_id = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []];

                var map = L.map('map').setView([41.83, -87.68], 4);
                var map2 = L.map('map2').setView([41.83, -87.68], 4);

                // creating a map

                L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                    attribution: 'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://mapbox.com">Mapbox</a>',
                    maxZoom: 18,
                    noWrap: true,
                    id: 'ygordon22.cifd9ql4c53tbsmlx7cegx4iy',
                    accessToken: 'pk.eyJ1IjoieWdvcmRvbjIyIiwiYSI6ImNpZmQ5cW1idzUzeWFzNG03bjVqc3czZWEifQ.dpecRLb3F4lRAOvIVd5KpQ'
                }).addTo(map);

                L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                    attribution: 'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://mapbox.com">Mapbox</a>',
                    maxZoom: 18,
                    noWrap: true,
                    id: 'ygordon22.cifd9ql4c53tbsmlx7cegx4iy',
                    accessToken: 'pk.eyJ1IjoieWdvcmRvbjIyIiwiYSI6ImNpZmQ5cW1idzUzeWFzNG03bjVqc3czZWEifQ.dpecRLb3F4lRAOvIVd5KpQ'
                }).addTo(map2);

                var playbackOptions = {
                    playControl: true,
                    dateControl: true,
                    sliderControl: true,
                    tickLen: 60*60*1000
                };
                var playback = new L.Playback(map, null, null, playbackOptions);

                function change() {
                    if (num != 0) {
                        //alert("removing");
                        d3.select(".map").remove();
                    }

                    
                    var selectedIndex = select.property('selectedIndex'),
                    input = options[0][selectedIndex].__data__;
                    var chosenYear = parseInt(input.Hurricane);
                    index = selectedIndex -1;
                   
                    

                    //method to create linechart
                    if(index < 10)
                    {
                        updateline1(HurrData1[index],graphs[0]);
                        updateline1(HurrData2[index],graphs[1]);

                    }

                    var color;
//                    //alert(JSON.stringify(chosenYear));

                    if (input.Hurricane == 'All') {
                        var myline = new Array();
                        var polyline_options;
                        for (var k = 0; k < 10; k++) {
                            myline[k] = new Array();
                            for (var j = 0; j < wind[k].length; j++) {
                                if (wind[k][j] > 40) {  // coloring scheme
                                    color = 'red'
                                }
                                else {
                                    color = 'green'
                                }
                   myline[k][j] = new Array(2);
                   myline[k][j][0] = parseFloat(latitute[[k]][j]);
                   myline[k][j][1] = parseFloat(langitute[[k]][j]);
               }                         
                        polyline_options = {
                            color: 'red'
                         };    
                            
                       alert(JSON.stringify((myline[k])));
                             polyline["TOP5"+topNum.toString()]=L.polyline(myline[k],polyline_options).addTo(map);
                            
                             topNum++; 
                              
                            }
                        }
                    else if (input.Hurricane == 'TOP5') {
                        top5();
                        var myline = [[], [], [], [], []];
                        var polyline_options; 
                        top10();
                        
                        for (var k = 0; k < 5; k++) {
                             myline[k] = new Array();
                            for (var j = 0; j < wind_id[mytop5[k]].length; j++) {
                                if (wind_id[mytop5[k]][j] > 40) {  // coloring scheme
                                    color = 'red'
                                }
                                else {
                                    color = 'green'
                                }
                   myline[k][j] = new Array(2);
                   myline[k][j][0] = parseFloat(latitute_id[mytop5[k]][j]);
                   myline[k][j][1] = parseFloat(langitute_id[mytop5[k]][j]);
               }                         
                        polyline_options = {
                            color: 'red'
                         };    
                            
                       alert(JSON.stringify((myline[k])));
                             polyline["TOP5"+topNum.toString()]=L.polyline(myline[k],polyline_options).addTo(map);
                            
                             topNum++;     
                            }
                    }
                    
                    else if (input.Hurricane == 'TOP10') {

                        //alert("get to top 10");
                        var myline = [[], [], [], [], [], [], [], [], [], []];
                        var polyline_options; 
                        top10();
                        
                        for (var k = 0; k < 10; k++) {
                             myline[k] = new Array();
                            //alert(wind_id[mytop10[k]].length);
                            for (var j = 0; j < wind_id[mytop10[k]].length; j++) {
                                if (wind_id[mytop10[k]][j] > 40) {  // coloring scheme
                                    color = 'red'
                                }
                                else {
                                    color = 'green'
                                }
                   //alert(JSON.stringify(mytop10));
                   myline[k][j] = new Array(2);
        
                   //alert(latitute_id[mytop10[k]][j]);
                   myline[k][j][0] = parseFloat(latitute_id[mytop10[k]][j]);
                   //alert(myline[i][0]);
                   //alert(langitute_id[mytop10[k]][j]);
                   myline[k][j][1] = parseFloat(langitute_id[mytop10[k]][j]);
                   //alert(myline[i][1]);
               }                         
                        polyline_options = {
                            color: 'red'
                         };    
                            
                       alert(JSON.stringify((myline[k])));
                             polyline["TOP10"+topNum.toString()]=L.polyline(myline[k],polyline_options).addTo(map);
                            
                             topNum++;     
                            }
                        }

                    else {

                        var uniqueNames = [];
                        var mynames = [];
                        var starting_position =0;
                        var ending_position =0;
                        //alert(index);
                        //alert(num_hurricanes[0].length);
                        
                        for(var j=0; j<(index+1);j++){
                            
                            //alert(num_hurricanes[j].length);
                            starting_position += num_hurricanes[j].length;
                        }
                        ending_position = starting_position + num_hurricanes[index].length;
                        
                        //alert(starting_position);
                        //alert(ending_position);
                        
                        if (orderHurr == 0) {
                            //alert('get here');
                               for(var k =0; k<num_hurricanes[index].length;k++){
                                   mynames.push(num_hurricanes[index][k]);
                               }
                            console.log(mynames.toString());
                            //alert(mynames.toString());
                            
                        }
                        else if (orderHurr == 1) {
                            //alert('get here');
                          //alert(num_hurricanes.toString());
                            
                            //alert(starting_position);
                            //alert(ending_position);
                            
                              //console.log(JSON.stringify(Timedict));
                              console.log(Timedict.length)
                              for(var k=0;k<Timedict.length;k++){
                                  console.log(Timedict[k].key);
                                  if (Timedict[k].key > starting_position && Timedict[k].key < ending_position){
                                      console.log('pushed this');
                                      console.log(num_hurricanes[index][Timedict[k].key-starting_position]);
                                      mynames.push(num_hurricanes[index][Timedict[k].key-starting_position]);
                                  }
                          }
                            //alert('printing');
                            console.log(mynames.toString());
                            //alert(mynames.toString());
                        }
                        
                        else if (orderHurr == 2) {
                               console.log(Speeddict);
                                         for(var k=0;k<Speeddict.length;k++){
                                  console.log(Speeddict[k].key);
                                  if (Speeddict[k].key > starting_position && Speeddict[k].key < ending_position){
                                      console.log('pushed this');
                                      console.log(num_hurricanes[index][Speeddict[k].key-starting_position]);
                                      mynames.push(num_hurricanes[index][Speeddict[k].key-starting_position]);
                                  }
                          }
                            //alert('printing');
                            console.log(mynames.toString());
                            //alert(mynames.toString());
                            
                        }

                        $.each(mynames, function (i, el) {
                            if ($.inArray(el, uniqueNames) === -1) uniqueNames.push(el);
                        });
                        uniqueNames.push("all");
                    }


                    // Creating a legend with all hurricane name
                      if (num != 0) {
                        //alert("removing");
                d3.select("#hurricanelist").selectAll("input").remove();
                d3.select("#hurricanelist").selectAll('label').remove();

                d3.select("#hurricanelist2").selectAll("input").remove();
                d3.select("#hurricanelist2").selectAll('label').remove();
                    }
                      svg = d3.select("#hurricanelist").selectAll("input")
                          .data(uniqueNames)
                          .enter()
                          .append('label')
                          .style("font-size", "12px")
                              .attr('for', function (d, i) { return 'a' + i; })
                              .text(function (d) { return d; })
                              .append("input")
                              .attr("val", false)
                              .attr("type", "checkbox")
                              .attr("id", function (d, i) { return uniqueNames[i]; })
                              .attr("onClick", "modify(this)")
                              .attr("onClick", "drawPath(this)");

                      svg = d3.select("#hurricanelist2").selectAll("input")
                           .data(uniqueNames)
                           .enter()
                           .append('label')
                           .style("font-size", "12px")
                               .attr('for', function (d, i) { return 'a' + i; })
                               .text(function (d) { return d; })
                               .append("input")
                               .attr("val", false)
                               .attr("type", "checkbox")
                               .attr("id", function (d, i) { return uniqueNames[i]; })
                               .attr("onClick", "modify(this)")
                               .attr("onClick", "drawPath(this)");
                    num++;

                }

                function changeOrder() {
                    var selectedIndex = order.property('selectedIndex'),
                    input = options2[0][selectedIndex].__data__;
                    var myorder = input.order;
                    //alert(myorder);

                    if (myorder == 'chronologically') {
                        //console.log(JSON.stringify(Timedict));
                        orderHurr = 1;
                    }

                    else if (myorder == 'MaxWindSpeed') {
                        console.log(JSON.stringify(Speeddict));
                        orderHurr = 2;
                    }
                    else if (myorder == 'alphabetically'){
                        //alert("that was chosen");
                        orderHurr = 0;
                    }
                };
                
                  function drawPath(that){
                      
                  var check = $(that).attr("val");      
                  //alert(check);  
                  var polyline_options; 
                  var myline;
                  
                  if (check == 'false'){
                   myline = new Array();
                  var dot = [];
                  var val = $(that).attr("id");
                     //alert('in modify');
                     //alert(val);
                     for ( var key in Namedict ) {

                     //alert(Namedict[key].value);
                     //alert(Namedict[key].key);

                      var mykey = Namedict[key].key;

                     if ( Namedict[key].value == val){
                         //alert("match");
                         console.log(wind_id[Namedict[key].key].length);
                         for( var i =0; i<wind_id[Namedict[key].key].length;i++){
                             //alert(wind_id[Namedict[key].key][i]);

                       if (wind_id[Namedict[key].key][i] > 40){  // coloring scheme
                        color ='red'
                    }
                        else{
                            color = 'green'
                        }
                             
                   myline[i] = new Array(2);
                   myline[i][0] = parseFloat(latitute_id[mykey][i])
                   myline[i][1] = parseFloat(langitute_id[mykey][i])
                   
               }                         
                        polyline_options = {
                            color: 'red'
                         };
                         
                        polyline[val] = L.polyline(myline,polyline_options).addTo(map);
            // polyline = L.polyline(myline,polyline_options).addTo(map);
                         
                         break;
                     }
                     }
                  }
                      else if(check == 'true'){
                          var val = $(that).attr("id");
                          //alert(val);
                          //alert(polyline[val]);
                         map.removeLayer(polyline[val]);
                          if (dateLine[val]){
                         map.removeLayer(dateLine[val]);
                          }
                      }
                     modify(that);
                  }
                
                function modify(that) {
                    
                    var val = $(that);//.attr("id");
                    var selName = val.attr("id");
                    if (val.context.attributes.val.value == "true") {
                        val.context.attributes.val.value = "false";
                        for (var i = 0; i < hurriSelection.length; i++) {
                            if (selName == hurriSelection[i].values[0].NAME) {
                                //hurriSelection.push(hurricanesByID[i]);
                                hurriSelection.splice(i, 1);
                                console.log(hurriSelection);
                                break;
                            }
                        }
                        //This is where we will need to run the remove code for a single hurricane.


                    } else {
                        val.context.attributes.val.value = "true"
                        
                        for (var i = 0; i < hurricanesByID.length; i++) {
                            if (selName == hurricanesByID[i].values[0].NAME) {
                                hurriSelection.push(hurricanesByID[i]);
                                break;
                            }
                        }
                        console.log(hurriSelection);

                        var geoJsonObjects = [];

                        for (var hurricane in hurriSelection) {
                            var lnglat = [];
                            var time = [];
                            console.log(hurricane);
                            for (var hurr in hurriSelection[hurricane].values) {

                                var strDate;
                                lnglat.push([hurriSelection[hurricane].values[hurr].LOG, hurriSelection[hurricane].values[hurr].LAT]);
                                var hour = hurriSelection[hurricane].values[hurr].HOURS[0] + "" + hurriSelection[hurricane].values[hurr].HOURS[1];
                                //strDate = val.YEAR + " " + val.MONTH + " " + val.DAY + " " + val.HOURS[0] + val.HOURS[1] + ":00:00";

                                var tempDate = Date.UTC(hurriSelection[hurricane].values[hurr].YEAR, hurriSelection[hurricane].values[hurr].MONTH, hurriSelection[hurricane].values[hurr].DAY, hour);
                                time.push(tempDate);
                            } // End of the for function.

                            var geoJson = {
                                "type": "Feature",
                                "geometry": {
                                    "type": "MultiPoint",
                                    "coordinates": lnglat
                                },
                                "properties": {
                                    "time": time
                                }
                            };

                            geoJsonObjects.push(geoJson);

                        }

                        if (geoJsonObjects.length < 2) {

                            playback.setData(geoJsonObjects);

                        } else {
                            playback.setData(geoJsonObjects);
                        }

                        for (var key in Namedict) {

                      var mykey = Namedict[key].key;

                     if ( Namedict[key].value == val){
                         //alert("match");
                         console.log(wind_id[Namedict[key].key].length);
                         for( var i =0; i<wind_id[Namedict[key].key].length;i++){
                             //alert(wind_id[Namedict[key].key][i]);

                       if (wind_id[Namedict[key].key][i] > 40){  // coloring scheme
                        color ='red'
                    }
                        else{
                            color = 'green'
                        }

                // adding a circle for every hurricane generated by user specification.               
                   var circle = L.circle([latitute_id[mykey][i],langitute_id[mykey][i]], 500, {
            color: color,
            fillColor: '#f03',
            fillOpacity: 0.5
        }).addTo(map)

              //alert('here');

               }
                         break;
                     }
                     }
                }
                }


                function top5() {
                    var maxspeed = [];

                    Array.max = function (array) {
                        return Math.max.apply(Math, array);
                    };
                    // finding max speed for each hurricane 
                    for (var i = 0; i < wind_id.length; i++) {
                        maxspeed.push(Array.max(wind_id[i]));
                    }

                    // finding the strongest 5 hurricanes 

                    for (var k = 0; k < 5; k++) {
                        var i = maxspeed.indexOf(Math.max.apply(Math, maxspeed));
                        mytop5.push(i);
                        maxspeed.splice(i, 1);
                    }
                }; //End of the top 5 function.

                function top10() {
                    var maxspeed = [];
                    Array.max = function (array) {
                        return Math.max.apply(Math, array);
                    };
                    // finding max speed for each hurricane 
                    for (var i = 0; i < wind_id.length; i++) {
                        maxspeed.push(Array.max(wind_id[i]));
                    }

                    // finding the strongest 10 hurricanes 

                    for (var k = 0; k < 10; k++) {
                        var i = maxspeed.indexOf(Math.max.apply(Math, maxspeed));
                        mytop10.push(i);
                        maxspeed.splice(i, 1);
                    }
                }; //End of the top 10 function.
                
                
          
        $(function() {
                $('#datepicker').datepicker();
                 $('#datepicker').datepicker('option', 'onSelect', function(dateText,inst) {      
                     //alert(dateText)
                     var i =0;
                     //var dateNames = [];
                     //var uniqueDateNames = [];
                     for(var key in day_lat) {
                        if(day_lat.hasOwnProperty(key)) {
                           if(key.indexOf(dateText) != -1){
                               mydateline[i] = new Array(2);
                               mydateline[i][0] = parseFloat(day_lat[key]);
                               mydateline[i][1] = parseFloat(day_lag[key]);
                               dateNames[numHurrDate] = day_name[key];
                               i++;
                               alert(numHurrDate);
                               numHurrDate++;
               }                         
                       var line_options = {
                            color: 'red'
                         };
                        }
                     }
         //dateLine[dateText] = L.polyline(mydateline,line_options).addTo(map);
                     
                         $.each(dateNames, function (i, el) {
                            if ($.inArray(el, uniqueDateNames) === -1) uniqueDateNames.push(el);
                        });
                     
                     //alert('chosen hurricane');
                     //alert(uniqueDateNames[0]);
                     dateLine[uniqueDateNames[dateCounter]] = L.polyline(mydateline,line_options).addTo(map);
                        
                     if(dateCounter >0 || num >0){
                d3.select("#hurricanelist").selectAll("input").remove();
                d3.select("#hurricanelist").selectAll('label').remove();
                     }
                    d3.select("#hurricanelist").selectAll("input")
                          .data(uniqueDateNames)
                          .enter()
                          .append('label')
                          .style("font-size", "12px")
                              .attr('for', function (d, i) { return 'a' + i; })
                              .text(function (d) { return d; })
                              .append("input")
                              .attr("val", false)
                              .attr("type", "checkbox")
                              .attr("id", function (d, i) { return uniqueDateNames[i]; })
                              .attr("onClick", "modify(this)")
                              .attr("onClick", "drawPath(this)");
                     
                           dateCounter++; 
                        });
                   });
                
                
                d3.csv("data/Hurricanes.csv", function (error, text) {
                    console.log(text);
                    select = d3.select("#optionmenu").append("select").on("change", change);
                    options = select.selectAll('option').data(text);
                    var selection = options.enter().append("option").text(function (d) { return d.Hurricane; });
                });

                d3.csv("data/order.csv", function (error, text) {
                    order = d3.select("#ordermenu").append("select").on("change", changeOrder);
                    options2 = order.selectAll('option').data(text);
                    var selection2 = options2.enter().append("option").text(function (d) { return d.order; });

                });

                //The section below grabs the hurricanes from 2005-2014 and groups them by hurricane YEAR. Thus breaking the file into 10 objects instead of 5000 entries.
                d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                    var i = 0;
                    var data = d3.nest()
                        .key(function (d) {
                            return d.YEAR;
                        })
                    .rollup(function (leaves) {
                        for (var j = 0 ; j < leaves.length; j++) {
                            langitute[i][j] = (leaves[j].LOG);
                            latitute[i][j] = (leaves[j].LAT);
                            wind[i][j] = (leaves[j].MaxWind);
                            names[i][j] = (leaves[j].NAME);
                        }
                        i++;
                        return leaves.length;
                    })
                    .entries(text);
                });

                //The section below grabs the hurricanes from 2005-2014 and groups them by hurricane YEAR. Thus breaking the file into 10 objects instead of 5000 entries.
                d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                    var i = 0;
                    var data = d3.nest()
                        .key(function (d) {
                            return d.NAME;
                        }).entries(text);

                    for (var i = 0; i < data.length; i++) {
                        hurricanesByID.push(data[i]);
                    }
                    console.log("hurricane obj by id");
                    console.log(data);
                });
            
                // This function gets clusters by year, month, day
                
                           d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                    var i = 0;
                    var data = d3.nest()
                        .key(function (d) {
                            return d.YEAR;
                        })
                        .key(function (d) {
                            return d.MONTH;
                        })
                    .key(function (d) {
                            return d.DAY;
                        })
                    .rollup(function (leaves) {
                        //alert(JSON.stringify(leaves[0]));
                        var mykey = leaves[0].MONTH + "/" + leaves[0].DAY + "/" +leaves[0].YEAR;
                        console.log(mykey);
                        for (var j = 0 ; j < leaves.length; j++) {
                            mykey += "|" + j.toString();
                            
                            day_lat[mykey] =  leaves[j].LAT;
                            day_lag[mykey] =  leaves[j].LOG;
                            day_wind[mykey] = leaves[j].MaxWind;
                            day_name[mykey] = leaves[j].NAME;
                        }
                        i++;
                        return leaves.length;
                    })
                    .entries(text);
                               
                });
                
                //The function below grabs the hurricane data and breaks it up into HURID.
                
                d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                    var i = 0;
                    var data = d3.nest()
                        .key(function (d) {
                            return d.HURID;
                        })
                    .rollup(function (leaves) {
                        //alert(JSON.stringify(leaves[0]));
                        for (var j = 0 ; j < leaves.length; j++) {
                            // creating arrays for all the hurricane

                            langitute_id[i][j] = (leaves[j].LOG);
                            latitute_id[i][j] = (leaves[j].LAT);
                            wind_id[i][j] = (leaves[j].MaxWind);
                            year_id[i][j] = (leaves[j].YEAR);
                        }

                        // Should be opposite, but it's not working
                        // very weird it always make the number the key ??
                        // works anyways 

                        Namedict.push({
                            key: i.toString(),
                            value: leaves[0].NAME
                        });

                        Timedict.push({
                            key: i.toString(),
                            value: leaves[0].MONTH
                        });

                        Speeddict.push({
                            key: i.toString(),
                            value: leaves[0].MaxWind
                        });


                        i++;
                        return leaves.length;
                    })
                        .entries(text);

                    //debugging code

                    /* console.log(langitute_id.toString());
                     console.log(latitute_id.toString());
                     console.log(wind_id.toString());
                     console.log(year_id.toString());
                     console.log('value of i',i);
                     
     
                   for ( var key in Namedict ) {
                       console.log(key);
                       console.log(Namedict[key].value);
                       console.log(Namedict[key].key);
                     }  
     
                      for ( var key in Speeddict ) {
                       console.log(key);
                       console.log(Speeddict[key].value);
                       console.log(Speeddict[key].key);
                      }
     
                      for ( var key in Timedict ) {
                       console.log(key);
                       console.log(Timedict[key].value);
                       console.log(Timedict[key].key);
                      }
                      */


                    Timedict = sortOnValue(Timedict);
                    Speeddict = sortOnValue(Speeddict);
                    
                
                    console.log(num_hurricanes.length);
                    
                    for(var i=0;i<num_hurricanes.length;i++){
                    $.each(names[i], function (k, el) {
                            if ($.inArray(el, num_hurricanes[i]) === -1) num_hurricanes[i].push(el);
                        });
                        console.log('get here');
                        console.log(num_hurricanes[i].toString());
                        console.log(num_hurricanes[i].length);
                        
                    }
                     //alert(num_hurricanes.toString());
                    /* 
                    console.log('after sorting');
                    
                     for ( var key in Timedict ) {
                        console.log(key);
                        console.log(Timedict[key].value);
                        console.log(Timedict[key].key);
                       }
                       
                    
                    console.log('printing the speeds');
                    
                    
                       for ( var key in Speeddict ) {
                        console.log(Speeddict[key].value);
                        console.log(Speeddict[key].key);
                       }
                       */

                });

                function sortOnValue(dict) {
                    var sortable = [];
                    var temp = []
                    for (var key in dict) {
                        sortable.push([key, dict[key].value])
                    }
                    sortable.sort(function (a, b) { return a[1] - b[1] })
                    // console.log(JSON.stringify(sortable));

                    for (var key in sortable) {
                        temp.push({
                            key: sortable[key][0],
                            value: sortable[key][1]
                        });
                    }

                    return temp;
                }; //End of the sortOnValue function.

/*
                function playHit() {
                    console.log("just pushed play");
                    console.log(hurricanesByID);
                    d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {

                        //Group the data by hurricane id
                        var data = d3.nest()
                        .key(function(d) {
                            return d.HURID;
                        }).entries(text);

                        var hurricaneOne = data[0];
                        console.log(hurricaneOne);
                        var lnglat = [];
                        var time = [];

                        for (var i = 0; i < hurricaneOne.values.length; i++) {
                            var strDate;
                            lnglat.push([hurricaneOne.values[i].LOG, hurricaneOne.values[i].LAT]);
                            var hour = hurricaneOne.values[i].HOURS[0] + "" + hurricaneOne.values[i].HOURS[1];
                            strDate = hurricaneOne.values[i].YEAR + " " + 
                                        hurricaneOne.values[i].MONTH + " " + 
                                        hurricaneOne.values[i].DAY + " " +
                                        hurricaneOne.values[i].HOURS[0] + hurricaneOne.values[i].HOURS[1] + 
                                        ":00:00";
                            var tempDate = Date.UTC(hurricaneOne.values[i].YEAR, hurricaneOne.values[i].MONTH, hurricaneOne.values[i].DAY, hour);//hurricaneOne.values[i].HOURS);
                            console.log(tempDate);
                            //console.log(strDate);
                            //console.log(toTimestamp(strDate));
                            time.push(tempDate);
                            //Year Month Day time

                            //sleep(1000);

                        }; //End of the for function.

                        var geoJson = {
                            "type": "Feature",
                            "geometry": {
                                "type": "MultiPoint",
                                "coordinates": lnglat
                            },
                            "properties": {
                                "time": time
                            }

                        };

                        console.log(geoJson);

                        var playbackOptions = {
                            playControl: true,
                            dateControl: true,
                            tickLen: 1000,
                            sliderControl: true,
                            //speed: 2000,
                            //maxInterpolationTime: 4*60*6000
                        };

                        var playback = new L.Playback(map, geoJson, null, playbackOptions);

                        //playback.setData(geoJson);

                        //var playback = new L.Playback(map, geoJson, null, playbackOptions);
                    }); //End the d3.csv call.
                }; //End of the Play function.
*/
                function sleep(milliseconds) {
                    var start = new Date().getTime();
                    for (var i = 0; i < 1e7; i++) {
                        if ((new Date().getTime() - start) > milliseconds) {
                            break;
                        }
                    }
                }; //End of the sleep function.

                function toTimestamp(strDate) {
                    var datum = Date.parse(strDate);
                    return datum/1000;
                }; //End of the toTimestamp function.
                    
            </script>

        </div>
        <script type=text/javascript>
            d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
                //Create a year array to hold the count of hurricanes per year.
                var yearArray = [0,0,0,0,0,0,0,0,0,0];

                //Group the data by hurricane id
                var data = d3.nest()
                .key(function(d) {
                    return d.HURID;
                }).entries(text);

                //Loop through the data to get the count of hurricanes per year.
                for (var i = 0; i < data.length; i++) {
                    //The "-0" is to force the conversion from string to integer for use in the switch case.
                    switch(data[i].values[0].YEAR - 0) {
                        case 2005:
                            yearArray[0]++;
                            console.log("2005");
                            break;
                        case 2006:
                            yearArray[1]++;
                            break;
                        case 2007:
                            yearArray[2]++;
                            break;
                        case 2008:
                            yearArray[3]++;
                            break;
                        case 2009:
                            yearArray[4]++;
                            break;
                        case 2010:
                            yearArray[5]++;
                            break;
                        case 2011:
                            yearArray[6]++;
                            break;
                        case 2012:
                            yearArray[7]++;
                            break;
                        case 2013:
                            yearArray[8]++;
                            break;
                        case 2014:
                            yearArray[9]++;
                            break;
                    }
                
                } //Ends the for loop.
                //Print out the content of the yearArray to the console for checking.
                //console.log(yearArray);
            }); //End the d3.csv call.
        </script>
	</body>
</html>