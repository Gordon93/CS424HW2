<!DOCTYPE html>

<style type="text/css">

.map div { 
    
  height: 800px; 
  width: 500px;
  font: 10px sans-serif;
  background-color: blue;
  text-align: right;
  padding: 3px;
  margin: 1px;
  color: white;

}

</style>
<html>
  <head>
    <title> D3 page template </title>     
       <div id = top style = "width: 100vh; height: 90vh;" >
    <div id = "map" style = "height: 50%;"></div>
    <div id = "legend" style = "height: 50% ; "></div>
     </div>
    
      
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"
    ></script> 
      <head><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
      
       <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
      </head>
      <script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>

  </head>
  <body>
    <script type="text/javascript">
       var select;
       num =0;
        
        var latitute =[[],[],[],[],[],[],[],[],[],[]];
        var langitute =[[],[],[],[],[],[],[],[],[],[]];
        var wind =[[],[],[],[],[],[],[],[],[],[]];
        var names =[[],[],[],[],[],[],[],[],[],[]];
        
        function change() {
              if (num !=0){
                  //alert("removing");
            d3.select(".map").remove();
              }
            
             var selectedIndex = select.property('selectedIndex'),
            input = options[0][selectedIndex].__data__;
            var chosenYear = parseInt(input.Hurricane);
            var index = selectedIndex -1;
            // setting the map to point at Chicago
            var map = L.map('map').setView([41.83,-87.68], 4);
            
            // creating a map
            
            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 18,
    id: 'ygordon22.cifd9ql4c53tbsmlx7cegx4iy',
    accessToken: 'pk.eyJ1IjoieWdvcmRvbjIyIiwiYSI6ImNpZmQ5cW1idzUzeWFzNG03bjVqc3czZWEifQ.dpecRLb3F4lRAOvIVd5KpQ'
}).addTo(map);
            
            
                    var color;
                    for (var i=0 ;i<wind[index].length;i++){
            if (wind[index][i] > 20){  // coloring scheme
                color ='red'
            }
                else{
                    color = 'green'
                }
                
        // adding a circle for every hurricane generated by user specification.                
     var circle = L.circle([latitute[index][i],langitute[index][i]], 500, {
    color: color,
    fillColor: '#f03',
    fillOpacity: 0.5
}).addTo(map)
     }
          num++;  
            
var uniqueNames = [];
$.each(names[index], function(i, el){
    if($.inArray(el, uniqueNames) === -1) uniqueNames.push(el);
});
            
            console.log("unique_name",uniqueNames.toString());
            
            // Creating a legend with all hurricane name
            
                   d3.select("body").selectAll("input")
.data(uniqueNames)
.enter()
.append('label')
    .attr('for',function(d,i){ return 'a'+i; })
    .text(function(d) { return d; })
.append("input")
    .attr("checked", true)
    .attr("type", "checkbox")
    .attr("id", function(d,i) { return 'a'+i; })
    .attr("onClick", "modify(this)");
        }
            
        
   d3.csv("data/Hurricanes.csv", function(error, text){
        console.log(text);
          select = d3.select("body").append("select").on("change", change);
    options = select.selectAll('option').data(text); 
var selection = options.enter().append("option").text(function(d) { return d.Hurricane; });
       
   });

       //The section below grabs the hurricanes from 2005-2014 and groups them by hurricane YEAR. Thus breaking the file into 10 objects instead of 5000 entries.
    d3.csv("data/AtlHurricane2005-2014.csv", function (error, text) {
     var i = 0;
      var data = d3.nest()
          .key(function(d) {
            return d.YEAR;
          })
      .rollup(function(leaves){
          for (var j =0 ;j< leaves.length; j++){   
               langitute[i][j]= (leaves[j].LOG);
               latitute[i][j] = (leaves[j].LAT);
               wind[i][j] = (leaves[j].MaxWind);
               names[i][j] = (leaves[j].NAME);
          }
          i++;
          return leaves.length;})
      .entries(text);
    });
     //This is a throw away comment.   
        
    </script>
  </body>
  </html>
